import numpy as np
from PIL import Image, ImageDraw, ImageFont
import os

def create_handwriting_templates(characters, output_dir, font_path="../create_train_data/fonts/source/source_font.ttf"):
    """
    고딕체 글자와 손글씨 공간이 있는 템플릿 이미지들을 생성
    
    Args:
        characters (list): 생성할 한글 글자 리스트
        output_dir (str): 결과물을 저장할 디렉토리 경로
        font_path (str): 고딕체 폰트 파일 경로
    """
    # 출력 디렉토리 생성
    os.makedirs(output_dir, exist_ok=True)
    
    # 선명한 텍스트를 위해 실제 출력 크기보다 2배 큰 이미지에 렌더링
    scale_factor = 2
    target_size = (256, 128)
    scaled_size = (target_size[0] * scale_factor, target_size[1] * scale_factor)
    
    # 폰트 설정 (고딕체) - 스케일에 맞춰 크기 조정
    font_size = 80 * scale_factor
    font = ImageFont.truetype(font_path, font_size)
    
    for char in characters:
        # 고해상도 이미지 생성
        image = Image.new('RGB', scaled_size, 'white')
        draw = ImageDraw.Draw(image)

                # 왼쪽 영역의 중앙점 계산
        left_center_x = scaled_size[0] // 4
        center_y = scaled_size[1] // 2
        
        # 왼쪽 영역에 고딕체 글자 그리기
        bbox = draw.textbbox((0, 0), char, font=font)
        text_width = bbox[2] - bbox[0]
        text_height = bbox[3] - bbox[1]
        
        # 정확한 중앙 위치 계산
        x = left_center_x - text_width // 2
        y = center_y - text_height // 2
        
        # 글자를 검은색으로 그리기
        draw.text((x, y), char, fill=(0, 0, 0), font=font)
        
        # 이미지 크기를 원래 크기로 줄이기 (안티앨리어싱 적용)
        image = image.resize(target_size, Image.Resampling.LANCZOS)
        
        # 파일 저장 (높은 품질)
        output_path = os.path.join(output_dir, f'0_{ord(char)}.png')
        image.save(output_path, 'PNG', quality=95)

# PDF에서 추출한 글자 210개 리스트
characters = [
    '겅', '겆', '겜', '겯', '궓', '기', '긽', '꺷', '꺾', '껙', '꽁', '꽍', '꾶', '꿀', '꿋',
    '뀀', '뀻', '끎', '끕', '낳', '냄', '냱', '넧', '넨', '놋', '놨', '놰', '뇔', '뇹', '늡',
    '닑', '댽', '뎬', '돎', '됷', '둠', '뒣', '듀', '듬', '땀', '땋', '뗶', '뚦', '뛒', '뛰',
    '뜸', '띔', '랖', '램', '럤', '렝', '련', '렵', '렽', '롯', '롷', '롼', '뢋', '룡', '룩',
    '뤇', '륑', '륨', '륿', '릙', '릞', '링', '맷', '먛', '멈', '멱', '멼', '몴', '뫴', '뭏',
    '뭣', '뭻', '뮴', '바', '밝', '뱝', '벋', '봃', '뵂', '뵐', '뵨', '불', '붻', '뺍', '뺐',
    '뺙', '뽮', '뾏', '쀭', '삘', '삥', '사', '색', '샛', '솎', '솰', '숌', '숭', '싀', '싇',
    '식', '싫', '싱', '싹', '쌤', '쎻', '쏞', '쏫', '쐬', '쑕', '쑹', '씀', '앃', '앍', '압',
    '얌', '얹', '얼', '얽', '엔', '옆', '예', '옫', '왓', '욉', '욧', '워', '웬', '윑', '유',
    '윩', '읓', '잡', '잿', '쟎', '정', '젯', '졎', '존', '죽', '줊', '중', '쥐', '쥿', '즢',
    '즶', '짓', '짘', '짠', '쨋', '쮪', '쯓', '찝', '착', '챤', '챨', '첂', '첺', '쳰', '초',
    '촤', '쵮', '쵕', '축', '춫', '췽', '츯', '컫', '켓', '쾀', '쿰', '퀵', '큭', '탭', '턉',
    '텝', '톕', '톤', '툼', '튠', '트', '틂', '틥', '펨', '퐁', '퐱', '푐', '푻', '퓐', '플',
    '핢', '핥', '험', '혤', '홉', '확', '홴', '횳', '훗', '휊', '휩', '휴', '흥', '흫', '힙'
]

# 추가 학습을 위한 글자 290개 리스트트
characters2 = [
    '갈', '갸', '걀', '걔', '검', '겨', '곁', '곧', '곰', '귀', '규', '그', '긍', '깃', '깊',
    '깔', '깡', '꼬', '꽃', '꾸', '꿈', '뀌', '끄', '끼', '나', '낭', '내', '냉', '너', '녀',
    '녁', '농', '뇌', '누', '눈', '눕', '늘', '늦', '닉', '달', '담', '대', '덕', '도', '독',
    '돈', '돌', '동', '됨', '두', '둥', '뒤', '드', '득', '땅', '때', '떠', '떡', '뗌', '또',
    '뚜', '뚱', '뛴', '뜨', '뜻', '라', '락', '랑', '래', '랭', '려', '력', '령', '례', '로',
    '록', '론', '롤', '뢰', '루', '류', '륙', '름', '릉', '리', '린', '림', '립', '마', '막',
    '만', '말', '망', '매', '맥', '맨', '머', '먹', '멍', '메', '며', '명', '모', '목', '몰',
    '몸', '묘', '무', '문', '물', '미', '민', '밀', '박', '반', '발', '밤', '방', '배', '백',
    '뱀', '버', '번', '벌', '범', '법', '베', '벽', '변', '병', '보', '복', '본', '봉', '부',
    '북', '분', '불', '비', '빔', '빛', '빵', '삭', '산', '살', '삼', '상', '새', '생', '서',
    '석', '선', '설', '섬', '성', '세', '소', '속', '손', '송', '수', '숙', '순', '술', '숨',
    '쉬', '슬', '습', '승', '시', '신', '실', '심', '써', '쓰', '씨', '안', '알', '암', '애',
    '액', '야', '약', '양', '억', '언', '엄', '업', '역', '연', '열', '염', '영', '옥', '온',
    '올', '옹', '와', '완', '왕', '외', '요', '욕', '용', '우', '운', '울', '움', '웅', '원',
    '월', '위', '유', '육', '윤', '율', '융', '은', '을', '음', '읍', '응', '의', '이', '익',
    '인', '일', '임', '자', '작', '잔', '잠', '장', '재', '저', '적', '전', '절', '점', '접',
    '정', '제', '조', '족', '종', '좌', '죄', '주', '준', '줄', '중', '즉', '즐', '증', '지',
    '직', '진', '질', '집', '차', '착', '참', '창', '채', '책', '처', '척', '천', '철', '첨',
    '청', '체', '초', '총', '최', '추', '축', '춘', '충', '취', '측', '치', '친', '칠', '타',
    '탁', '탄', '태', '택', '토', '통', '퇴', '투', '특', '파', '판', '팔', '패', '편', '평',
    '포', '표', '품', '피', '필', '하', '학', '한', '할', '함', '합', '해', '행', '향', '허',
    '헌', '험', '혁', '현', '형', '호', '혼', '홍', '화', '확', '황', '회', '획', '횡', '효',
    '후', '훈', '훔', '훨', '휘', '흐', '흑', '흔', '흘', '흡', '희'
]

# 템플릿 생성
output_directory = "handwriting_templates2"
create_handwriting_templates(characters2, output_directory)